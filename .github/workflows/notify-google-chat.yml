name: Notify Google Chat for Renovate PRs

on:
  pull_request:
    types: [opened, synchronize, reopened]
    # Ejecuta en cualquier PR, sin importar rama ni archivo
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Print GitHub context
        run: echo '${{ toJson(github) }}'

      - name: Debug PR Info
        if: ${{ github.event.pull_request }}
        run: |
          echo "Actor: ${{ github.actor }}"
          echo "PR Title: ${{ github.event.pull_request.title }}"
          echo "PR URL: ${{ github.event.pull_request.html_url }}"
          echo "PR Head Ref: ${{ github.event.pull_request.head.ref }}"
          echo "PR Base Ref: ${{ github.event.pull_request.base.ref }}"
          echo "Is Renovate? ${{ startsWith(github.actor, 'renovate') }}"

      - name: Notify Google Chat
        if: ${{ github.event.pull_request && startsWith(github.actor, 'renovate') }}
        run: |
          curl -X POST -H 'Content-Type: application/json' \
            --data "{\"text\": \"ðŸ›  Renovate creÃ³ un nuevo PR:\n\n<${{ github.event.pull_request.html_url }}|${{ github.event.pull_request.title }}>\"}" \
            "${{ secrets.GOOGLE_CHAT_WEBHOOK_URL }}"
