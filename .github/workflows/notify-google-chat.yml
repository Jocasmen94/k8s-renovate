name: Notify Google Chat for PRs

on:
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch: # Añadido para ejecución manual

jobs:
  notify-google-chat:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' || github.event_name == 'workflow_dispatch'
    steps:
      - name: Debug Workflow Trigger
        run: |
          echo "Event Name: $GITHUB_EVENT_NAME"
          echo "Actor: $GITHUB_ACTOR"
          echo "Repository: $GITHUB_REPOSITORY"
          echo "Ref: $GITHUB_REF"
          echo "Base Ref: ${{ github.event.pull_request.base.ref }}"
          echo "Head Ref: ${{ github.event.pull_request.head.ref }}"
          echo "Event Path Content: $(cat $GITHUB_EVENT_PATH || echo 'File not found')"
      - name: Google Chat Notification
        uses: nakamuraos/google-chat-notifications@v3.4.0
        with:
          title: "PR Update"
          subtitle: ${{ github.event.pull_request.title || github.event.head_commit.message || 'No title available' }}
          webhookUrl: ${{ secrets.GOOGLE_CHAT_WEBHOOK_URL }}
          status: ${{ job.status }}
        if: always() # Asegura que se ejecute incluso si falla un paso previo